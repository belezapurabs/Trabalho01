create database if not exists Salao_bp;
use Salao_bp;
#drop database salao_bp;
/* Em construção: */

CREATE TABLE CONTATO (
    cod_contato integer PRIMARY KEY,
    Descrição_cantato varchar(80),
    FK_TIPO_CONTATO_Codigo integer,
    FK_PESSOA_COD_PESSOA integer
);
INSERT INTO CONTATO(
cod_contato,
Descrição_cantato,
FK_TIPO_CONTATO_Codigo,
FK_PESSOA_COD_PESSOA)

VALUES(81,'MARIA@GMAIL.COM',10,71),
(82,'2222-2222',20,72),
(83,'FLAVIS@GMAIL.COM',10,73),
(84,'JOAO NESC',30,74),
(85,'(27) 99999-3223',40,75),
(86,'1010-1010',20,76),
(87,'ANDERSON@GMAIL.COM',10,77),
(88,'JESSICA GONSALVES',30,78),
(89,'ALLANIS@GMAIL.COM',10,79);


SELECT*FROM TIPO_CONTATO;
SELECT *FROM CONTATO;
SELECT CONTATO.Descrição_cantato,TIPO_CONTATO.DESCRIÇÃO FROM CONTATO RIGHT OUTER JOIN TIPO_CONTATO ON (CONTATO.FK_TIPO_CONTATO_Codigo=TIPO_CONTATO.Codigo);
SELECT cod_contato,Descrição_cantato,DESCRIÇÃO from CONTATO inner join TIPO_CONTATO on (CONTATO.FK_TIPO_CONTATO_Codigo = TIPO_CONTATO.Codigo);

SELECT* FROM CONTATO GROUP BY FK_TIPO_CONTATO_Codigo; 

CREATE TABLE TIPO_CONTATO (
    Codigo integer PRIMARY KEY,
    DESCRIÇÃO varchar(80)
);
INSERT INTO TIPO_CONTATO(Codigo,
DESCRIÇÃO)
VALUES(10,'EMAIL'),
(20,'TELEFONE'),
(30,'FACEBOOK'),
(40,'CELULAR');

SELECT *FROM TIPO_CONTATO;

CREATE TABLE PESSOA (
    CPF integer,
    SEXO char(1),
    COD_PESSOA integer PRIMARY KEY,
    NOME varchar(150),
    LOGIN_Email varchar(150),
    SENHA INT,
    FK_TIPO_USER_COD_TIPOUSER INT
);
INSERT INTO PESSOA(CPF,
SEXO,
COD_PESSOA,
NOME,
LOGIN_Email,
SENHA,
FK_TIPO_USER_COD_TIPOUSER)
VALUES(1010,'F',71,'MARIA','MARIA@GMAIL.COM',12345,7001),
(2020,'F',72,'FLAVIS','FLAVIS@GMAIL.COM',12345,7001),
(3030,'M',73,'JEFF','JEFF@GMAIL.COM',12345,7001),
(4040,'M',74,'JOÃO','JOAO@GMAIL.COM',12345,7001),
(5050,'M',75,'ANDRE','ANDRE@GMAIL.COM',12345,7002),
(6060,'M',76,'WELLYTON','WELLYTON@GMAIL.COM',12345,7002),
(7070,'M',77,'ANDERSON','ANDERSON@GMAIL.COM',12345,7002),
(8080,'F',78,'JESSICA','JESSICA@GMAIL.COM',12345,7002),
(9090,'F',79,'ALLANIS','ALLANIS@GMAIL.COM',12345,7001);


SELECT *FROM PESSOA;
SELECT *FROM FUNCIONARIO;

SELECT PESSOA.NOME,FUNCIONARIO.SALARIO FROM FUNCIONARIO  RIGHT OUTER JOIN PESSOA ON(PESSOA.COD_PESSOA=FUNCIONARIO.FK_PESSOA_COD_PESSOA_FUNC);
SELECT * FROM PESSOA WHERE COD_PESSOA >=75;
#SELECT COUNT (SEXO) AS QTD, SEXO FROM PESSOA GROUP BY SEXO;

SELECT CPF,SEXO,NOME,DESCRIÇÃO from  PESSOA inner join TIPO_USER on (PESSOA.FK_TIPO_USER_COD_TIPOUSER = TIPO_USER.COD_TIPOUSER);

SELECT * FROM PESSOA GROUP BY FK_TIPO_USER_COD_TIPOUSER ; 

CREATE TABLE TIPO_LOCAL (
    Cod_tipo_local INT PRIMARY KEY,
    Descrição varchar(80)
);
INSERT INTO TIPO_LOCAL(COD_TIPO_LOCAL,
DESCRIÇÃO)
VALUES(101,'RUA'),(102,'AV');

SELECT *FROM TIPO_LOCAL;

CREATE TABLE BAIRRO (
    Nome_bairro varchar(80),
    Cod_bairro INT PRIMARY KEY,
    FK_MUNICIPIO_Cod_Municipio INT
);
INSERT INTO BAIRRO(Nome_bairro,
Cod_bairro,
FK_MUNICIPIO_Cod_Municipio)
VALUES('PRAIA MAR',21,31),
('GAIVOTAS',22,31),
('DIVINOPOLIS',23,31),
('GOIABEIRAS',24,32),
('VIANA',25,33),
('SERRA_SEDE',26,31),
('CARAPINA',27,31),
('FUNDÃO',28,34),
('PRAIA GRANDE',29,34);


SELECT Nome_bairro , Nome_municipio,FK_MUNICIPIO_Cod_Municipio from BAIRRO  INNER JOIN MUNICIPIO ON (BAIRRO.FK_MUNICIPIO_Cod_Municipio=MUNICIPIO.COD_MUNICIPIO) GROUP BY FK_MUNICIPIO_Cod_Municipio ;  

SELECT * FROM MUNICIPIO;
SELECT *FROM BAIRRO;
SELECT NOME_BAIRRO FROM BAIRRO WHERE FK_MUNICIPIO_COD_MUNICIPIO = 31;
SELECT Nome_bairro , Nome_municipio from BAIRRO INNER JOIN MUNICIPIO ON (BAIRRO.FK_MUNICIPIO_Cod_Municipio=MUNICIPIO.COD_MUNICIPIO);
CREATE TABLE LOCAL (
    CEP INT,
    Descrição varchar(80),
    Numero_Casa INT,
    FK_PESSOA_COD_PESSOA integer,
    FK_TIPO_LOCAL_Cod_tipo_local INT,
    FK_BAIRRO_Cod_bairro INT
);

INSERT INTO LOCAL(CEP,
Descrição,
Numero_Casa,
FK_PESSOA_COD_PESSOA,
FK_TIPO_LOCAL_Cod_tipo_local,
FK_BAIRRO_Cod_bairro)
VALUES(11111,'NOVA_ERA',12,71,101,21),
(11112,'NOVA_HORIZONTE',14,72,102,21),
(11113,'GOVERNADOR_VALADARES',15,73,101,22),
(11114,'CAPITÃO',102,74,102,23),
(11115,'VV',19,75,101,24),
(11116,'PREY',20,76,101,25),
(11117,'TEOFILO',1060,77,101,29),
(11118,'AGUAS_CLARAS',1014,78,101,28),
(11119,'PORTO_SEGURO',1111,79,101,27);


SELECT * FROM LOCAL GROUP BY FK_TIPO_LOCAL_Cod_tipo_local AND FK_TIPO_LOCAL_Cod_tipo_local ;

SELECT *FROM LOCAL;
SELECT * FROM bairro;
SELECT * FROM  LOCAL WHERE Descrição LIKE '%A%' AND FK_TIPO_LOCAL_Cod_tipo_local =101 ;
SELECT LOCAL.CEP,
LOCAL.Descrição,
LOCAL.Numero_Casa,
tipo_local.Descrição,
bairro.Nome_bairro,
PESSOA.NOME FROM LOCAL INNER JOIN tipo_local ON (LOCAL.FK_TIPO_LOCAL_Cod_tipo_local=tipo_local.Cod_tipo_local) 
inner join bairro on(LOCAL.FK_BAIRRO_Cod_bairro=BAIRRO.cod_bairro)
inner join Pessoa on(LOCAL.FK_PESSOA_COD_PESSOA=PESSOA.COD_PESSOA);

CREATE TABLE MUNICIPIO (
    Nome_municipio varchar(80),
    Cod_Municipio INT PRIMARY KEY,
    FK_ESTADO_Cod_Estado INT
);
INSERT INTO MUNICIPIO  (Nome_municipio,
Cod_Municipio ,
FK_ESTADO_Cod_Estado)
VALUES('SERRA',31,41),
('VITORIA',32,41),
('VILA_VELHA',33,41),
('ARACRUZ',34,41),
('ALEGRE',35,41);

SELECT *FROM MUNICIPIO;
SELECT * FROM  MUNICIPIO WHERE Nome_municipio LIKE 'V%' ;
SELECT Nome_municipio, Nome_Estado from MUNICIPIO INNER JOIN ESTADO ON (MUNICIPIO.FK_ESTADO_Cod_Estado=ESTADO.Cod_Estado);

CREATE TABLE ESTADO (
    Cod_Estado INT PRIMARY KEY,
    Nome_Estado CHAR(2)
);
INSERT INTO ESTADO  (Cod_Estado,
Nome_Estado)
VALUES(41,'ES'),
(42,'MG'),
(43,'RS'),
(44,'RJ'),
(45,'SP');

SELECT *FROM ESTADO;

CREATE TABLE ITENS (
    Cod_Item integer PRIMARY KEY,
    Nome varchar(150),
    Descrição varchar(80),
    Preço integer
);
INSERT INTO ITENS  (Cod_Item,
Nome,
Descrição,
Preço)
VALUES(50,'SELAGEM','SELAGEM',25.00),
(51,'CORTE','CORTE_MASCULINO',10.00),
(52,'CORTE_F','CORTE_FEMINO',40.00),
(53,'HIDRATAÇÃO','HIDRATAÇÃO_CAPILAR',25.00),
(54,'SHAMPOO_ALFAPART','Nutri Seduction Pear',70.00),
(55,'LOréal','Professionnel Absolut ',120.00),
(56,'MANICURE','UNHAS_DAS_MAOS',15.00),
(57,'PEDICURE','UNHAS_DAO_PES',15.00),
(58,'kit','kit_completo',200.00),
(59,'kit','kit_cauterização',150.00),
(60,'kit','kit_De_Esmalte',26.00);

SELECT *FROM ITENS;
SELECT NOME FROM ITENS WHERE PREÇO >= 25 AND COD_ITEM >=52 AND NOME != 'KIT';
SELECT NOME,PREÇO ,Preço-(2.5) AS 'PROMOÇÃO' FROM ITENS WHERE COD_item >=50 AND COD_item <= 60 AND NOME='KIT' OR NOME='CORTE';
SELECT Nome ,Preço FROM ITENS WHERE Descrição LIKE BINARY'%i%';
DELETE FROM ITENS WHERE Cod_Item = 60;


CREATE TABLE Tipo_Status (
    Cod_Tipo_Status integer PRIMARY KEY,
    Descrição varchar(80)
);
INSERT INTO Tipo_Status  (Cod_Tipo_Status,
Descrição)
VALUES(61,'FEITO'),
(62,'CANCELADO'),
(63,'ESPERANDO'),
(64,'CONFIRMADO');

SELECT *FROM TIPO_STATUS;


CREATE TABLE AGENDA (
    Cod_Agenda INT PRIMARY KEY,
    Hora_Agenda time,
    Data_Agenda DATE,
    FK_SERVICO_FK_ITENS_Cod_Item integer,
    FK_PESSOA_COD_PESSOA integer,
    FK_Tipo_Status_Cod_Tipo_Status integer,
    FK_FUNCIONARIO_FK_PESSOA_COD_PESSOA_FUNC integer
);

INSERT INTO AGENDA (Cod_Agenda,
Hora_Agenda,
Data_Agenda,
FK_SERVICO_FK_ITENS_Cod_Item,
FK_PESSOA_COD_PESSOA,
FK_Tipo_Status_Cod_Tipo_Status,
FK_FUNCIONARIO_FK_PESSOA_COD_PESSOA_FUNC)
VALUES(91,'15:00','2017/06/02',50,71,63,78),
(92,'16:00','2017/06/04',51,73,64,76),
(93,'13:00','2017/06/02',53,74,63,75),
(94,'08:00','2017/06/01',52,79,62,77),
(95,'09:00','2017/06/05',51,72,64,78);

SELECT PESSOA.NOME,AGENDA.DATA_AGENDA FROM PESSOA LEFT OUTER JOIN AGENDA ON(AGENDA.FK_PESSOA_COD_PESSOA=PESSOA.COD_PESSOA) ;

SELECT * FROM AGENDA GROUP BY FK_Tipo_Status_Cod_Tipo_Status  ;
SELECT *FROM AGENDA;
SELECT Hora_Agenda,Data_Agenda FROM AGENDA WHERE Cod_Agenda >= 91; 
UPDATE AGENDA SET Hora_Agenda ='10:00'WHERE Cod_Agenda= 92;
DELETE FROM AGENDA WHERE FK_Tipo_Status_Cod_Tipo_Status= 62;



SELECT AGENDA.Hora_Agenda,
AGENDA.Data_Agenda,
ITENS.Nome,
PESSOA.NOME,
Tipo_Status.Descrição FROM AGENDA INNER JOIN ITENS ON (AGENDA.FK_SERVICO_FK_ITENS_Cod_Item=ITENS.Cod_Item) 
inner join PESSOA on(AGENDA.FK_PESSOA_COD_PESSOA=PESSOA.COD_PESSOA)
inner join Tipo_Status on(AGENDA.FK_Tipo_Status_Cod_Tipo_Status=Tipo_Status.Cod_Tipo_Status);

CREATE TABLE SERVICO (
    TEMPO TIME,
    FK_ITENS_Cod_Item integer PRIMARY KEY
);
INSERT INTO SERVICO (TEMPO ,
FK_ITENS_Cod_Item)
VALUES('00:40',51),('01:00',52),('00:40',56),('00:40',57),('00:20',53);


SELECT *FROM SERVICO;
SELECT ITENS.Nome, ITENS.Descrição,SERVICO.TEMPO ,
ITENS.Preço from SERVICO INNER JOIN ITENS ON (SERVICO.FK_ITENS_Cod_Item=ITENS.Cod_Item);

CREATE TABLE PRODUTO (
    VALIDADE DATE,
    FK_ITENS_Cod_Item integer PRIMARY KEY
);
INSERT INTO PRODUTO (VALIDADE,
FK_ITENS_Cod_Item)
VALUES('2020/06/15',54),
('2020/09/20',55),
('2018/01/11',58),
('2020/07/22',59),
('2019/12/04',60);


SELECT * FROM ITENS;
SELECT *FROM PRODUTO;
UPDATE PRODUTO SET VALIDADE ='2018/01/11'WHERE FK_ITENS_Cod_Item = 54 AND 60;
SELECT ITENS.Nome, ITENS.Descrição,PRODUTO.VALIDADE ,
ITENS.Preço from PRODUTO INNER JOIN ITENS ON (PRODUTO.FK_ITENS_Cod_Item=ITENS.Cod_Item);

CREATE TABLE TIPO_USER (
    COD_TIPOUSER INT PRIMARY KEY,
    DESCRIÇÃO varchar(150)
);
INSERT INTO TIPO_USER(COD_TIPOUSER,DESCRIÇÃO)
VALUES(7001,'CLIENTE'),(7002,'ADMINISTRADOR');

SELECT * FROM TIPO_USER;

CREATE TABLE FUNCIONARIO (
    Salario FLOAT,
    FK_PESSOA_COD_PESSOA_FUNC integer PRIMARY KEY,
    FK_SERVICO_FK_ITENS_Cod_Item integer,
    FK_tipo_funcao_Codigo INT
);
INSERT INTO FUNCIONARIO (Salario,
FK_PESSOA_COD_PESSOA_FUNC ,
FK_SERVICO_FK_ITENS_Cod_Item,
FK_tipo_funcao_Codigo)
VALUES(937.00,75,51,302),
(1100.00,76,52,303),
(937.00,78,56,304),
(1100.00,77,50,301);


SELECT *FROM FUNCIONARIO;
SELECT FK_PESSOA_COD_PESSOA_FUNC ,Salario,SALARIO*(1.5) AS 'NOVO SALARIO'  FROM FUNCIONARIO  WHERE FK_PESSOA_COD_PESSOA_FUNC  >75 AND Salario >937  ;
UPDATE FUNCIONARIO SET Salario ='1500'WHERE FK_PESSOA_COD_PESSOA_FUNC =76;

SELECT* FROM tipo_funcao;

SELECT FUNCIONARIO.Salario,
PESSOA.NOME,
ITENS.Nome,
tipo_funcao.Descricao FROM FUNCIONARIO INNER JOIN PESSOA ON (FUNCIONARIO.FK_PESSOA_COD_PESSOA_FUNC=PESSOA.COD_PESSOA) 
inner join ITENS on(FUNCIONARIO.FK_SERVICO_FK_ITENS_Cod_Item=ITENS.Cod_Item)
inner join tipo_funcao on(FUNCIONARIO.FK_tipo_funcao_Codigo=tipo_funcao.Codigo);

CREATE TABLE Compra (
    COD_COMPRA INT PRIMARY KEY,
    DESCONTO FLOAT,
    DATA DATE,
    FK_PESSOA_COD_PESSOA integer
);
INSERT INTO COMPRA (COD_COMPRA,
DESCONTO,
DATA,
FK_PESSOA_COD_PESSOA)
VALUES(901,10,'2017/06/02',71),(902,12,'2017/06/04',73),(903,0,'2017/06/02',74),(904,10,'2017/06/01',79),(905,15,'2017/06/05',72);

SELECT PESSOA.NOME,COMPRA.DESCONTO,COMPRA.DATA FROM PESSOA LEFT OUTER JOIN COMPRA ON (COMPRA.FK_PESSOA_COD_PESSOA=PESSOA.COD_PESSOA);
 
SELECT *FROM ITENS;

SELECT *FROM COMPRA;
SELECT Compra.cod_compra,Compra.desconto,Compra.data,
pessoa.nome from Compra INNER JOIN PESSOA ON (Compra.FK_PESSOA_COD_PESSOA=PESSOA.COD_PESSOA);


CREATE TABLE tipo_funcao (
    Codigo INT PRIMARY KEY,
    Descricao varchar(150)
);

INSERT INTO tipo_funcao (Codigo,
Descricao)
VALUES(301,'SELAGEM'),(302,'CORTE'),(303,'CORTE_F'),(304,'MANICURE'),(305,'PEDICURE');

SELECT *FROM tipo_funcao;


CREATE TABLE Itens_compra (
    FK_Compra_COD_COMPRA INT,
    FK_ITENS_Cod_Item integer
);
INSERT INTO Itens_compra (FK_Compra_COD_COMPRA,
FK_ITENS_Cod_Item)

VALUES(901,71),(902,73),(903,74),(904,79),(905,72);



SELECT *FROM Itens_compra;

SELECT *FROM itens;
DELETE FROM Itens_compra WHERE FK_Compra_COD_COMPRA = 905;

SELECT compra.data,compra.desconto,
itens.nome,itens.preço
from itens_compra INNER JOIN Compra ON (Itens_compra.FK_Compra_COD_COMPRA=Compra.COD_COMPRA)
INNER JOIN ITENS ON (Itens_compra.FK_ITENS_Cod_Item=ITENS.COD_ITEM);
 
ALTER TABLE CONTATO ADD CONSTRAINT FK_CONTATO_1
    FOREIGN KEY (FK_TIPO_CONTATO_Codigo)
    REFERENCES TIPO_CONTATO (Codigo);
 
ALTER TABLE CONTATO ADD CONSTRAINT FK_CONTATO_2
    FOREIGN KEY (FK_PESSOA_COD_PESSOA)
    REFERENCES PESSOA (COD_PESSOA);
 
ALTER TABLE PESSOA ADD CONSTRAINT FK_PESSOA_1
    FOREIGN KEY (FK_TIPO_USER_COD_TIPOUSER)
    REFERENCES TIPO_USER (COD_TIPOUSER);
 
ALTER TABLE BAIRRO ADD CONSTRAINT FK_BAIRRO_1
    FOREIGN KEY (FK_MUNICIPIO_Cod_Municipio)
    REFERENCES MUNICIPIO (Cod_Municipio);
 
ALTER TABLE LOCAL ADD CONSTRAINT FK_LOCAL_0
    FOREIGN KEY (FK_PESSOA_COD_PESSOA)
    REFERENCES PESSOA (COD_PESSOA);
 
ALTER TABLE LOCAL ADD CONSTRAINT FK_LOCAL_1
    FOREIGN KEY (FK_TIPO_LOCAL_Cod_tipo_local)
    REFERENCES TIPO_LOCAL (Cod_tipo_local);
 
ALTER TABLE LOCAL ADD CONSTRAINT FK_LOCAL_2
    FOREIGN KEY (FK_BAIRRO_Cod_bairro)
    REFERENCES BAIRRO (Cod_bairro);
 
ALTER TABLE MUNICIPIO ADD CONSTRAINT FK_MUNICIPIO_1
    FOREIGN KEY (FK_ESTADO_Cod_Estado)
    REFERENCES ESTADO (Cod_Estado);
 
ALTER TABLE AGENDA ADD CONSTRAINT FK_AGENDA_1
    FOREIGN KEY (FK_SERVICO_FK_ITENS_Cod_Item)
    REFERENCES SERVICO (FK_ITENS_Cod_Item);
 
ALTER TABLE AGENDA ADD CONSTRAINT FK_AGENDA_2
    FOREIGN KEY (FK_PESSOA_COD_PESSOA)
    REFERENCES PESSOA (COD_PESSOA);
 
ALTER TABLE AGENDA ADD CONSTRAINT FK_AGENDA_3
    FOREIGN KEY (FK_Tipo_Status_Cod_Tipo_Status)
    REFERENCES Tipo_Status (Cod_Tipo_Status);
 
ALTER TABLE AGENDA ADD CONSTRAINT FK_AGENDA_4
    FOREIGN KEY (FK_FUNCIONARIO_FK_PESSOA_COD_PESSOA_FUNC)
    REFERENCES FUNCIONARIO (FK_PESSOA_COD_PESSOA_FUNC);
 
ALTER TABLE SERVICO ADD CONSTRAINT FK_SERVICO_1
    FOREIGN KEY (FK_ITENS_Cod_Item)
    REFERENCES ITENS (Cod_Item);
 
ALTER TABLE PRODUTO ADD CONSTRAINT FK_PRODUTO_1
    FOREIGN KEY (FK_ITENS_Cod_Item)
    REFERENCES ITENS (Cod_Item);
 
ALTER TABLE FUNCIONARIO ADD CONSTRAINT FK_FUNCIONARIO_1
    FOREIGN KEY (FK_PESSOA_COD_PESSOA_FUNC)
    REFERENCES PESSOA (COD_PESSOA);
 
ALTER TABLE FUNCIONARIO ADD CONSTRAINT FK_FUNCIONARIO_2
    FOREIGN KEY (FK_SERVICO_FK_ITENS_Cod_Item)
    REFERENCES SERVICO (FK_ITENS_Cod_Item);
 
ALTER TABLE FUNCIONARIO ADD CONSTRAINT FK_FUNCIONARIO_3
    FOREIGN KEY (FK_tipo_funcao_Codigo)
    REFERENCES tipo_funcao (Codigo);
 
ALTER TABLE Compra ADD CONSTRAINT FK_Compra_1
    FOREIGN KEY (FK_PESSOA_COD_PESSOA)
    REFERENCES PESSOA (COD_PESSOA);
 
ALTER TABLE Itens_compra ADD CONSTRAINT FK_Itens_compra_0
    FOREIGN KEY (FK_Compra_COD_COMPRA)
    REFERENCES Compra (COD_COMPRA);
 
ALTER TABLE Itens_compra ADD CONSTRAINT FK_Itens_compra_1
    FOREIGN KEY (FK_ITENS_Cod_Item)
    REFERENCES ITENS (Cod_Item);